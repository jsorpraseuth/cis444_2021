<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Chat Room {{room}}</title>
	</head>
	
	<body>
		<h1>Welcome to room {{room}}</h1>
		
		<div id="messages"></div>
		
		<form id="message_input_form">
			<input type="text" id="message_input" placeholder="Enter your message here.">
			<button type="submit">Send</button>
		</form>
		
	</body>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
	<script>
		const socket = io.connect("http://54.67.101.185:8080/");
		
		socket.on('connect', function() {
			socket.emit('join_room', {
				username: "{{username}}",
				room: "{{room}}"
			})
			
			let message_input = document.getElementById('message_input');
			document.getElementById('message_input_form').onsubmit = function(e) {
				e.preventDefault();
				// trim whitespace from message
				let message = message_input.value.trim();
				if(message.length) {
					socket.emit('send_message', {
						username: "{{username}}",
						room: "{{room}}",
						message: message
					});
				}
				message_input.value = '';
				// make input box active after message submission
				message_input.focus();
			}
		})
		
		socket.on('receive_message', function(data) {
			console.log(data);
			const newNode = document.createElement('div');
			newNode.innerHTML = '<b>${data.username}</b>:&nbsp; ${data.message}";
			document.getElementById('messages').appendChild(newNode);
		})
		
		socket.on('join_notification', function(data) {
			console.log(data);
			const newNode = document.createElement('div');
			newNode.innerHTML = '<b>${data.username}</b> has joined the room.";
			document.getElementById('messages').appendChild(newNode);
		})
	</script>


</html>